# Анализатор электронной почты на фишинг

Программа для автоматического анализа входящих писем на предмет спама и фишинга с GUI интерфейсом.

## Возможности

- **DNS проверки**: SPF, DKIM, DMARC, MX записи домена отправителя
- **Анализ контента**: поиск триггерных слов, проверка ссылок, обнаружение URL shorteners
- **Проверка вложений**: опасные расширения, двойные расширения
- **Анализ HTML**: поиск опасных тегов, скрытых элементов, форм с паролями
- **Обнаружение подмены бренда**: проверка соответствия упоминаемых брендов и домена отправителя
- **Проверка заголовков**: Return-Path, X-Mailer, Received
- **Система баллов риска**: автоматическая классификация писем (0-10 баллов)
- **GUI интерфейс**: управление аккаунтами, журнал проверок с детализацией
- **Автоматическое перемещение**: спам и фишинг перемещаются в папку "Спам"
- **Логирование**: результаты анализа сохраняются в JSON файлы

## Требования

- Python 3.8+
- Библиотеки из requirements.txt

## Установка

```bash
# Клонировать/скопировать проект
cd mpa

# Установить зависимости
pip install -r requirements.txt
```

## Запуск

```bash
python main.py
```

## Настройка почтовых аккаунтов

### Gmail
1. Включите IMAP в настройках Gmail
2. Создайте "Пароль приложения" в аккаунте Google (Безопасность → Двухэтапная аутентификация → Пароли приложений)
3. Используйте этот пароль вместо обычного

### Mail.ru / Yandex
1. Включите IMAP в настройках почты
2. Создайте пароль для внешних приложений

> Программа автоматически определяет IMAP сервер по домену почты для популярных сервисов (Gmail, Mail.ru, Yandex, Outlook и др.)

## Как работает анализ

### Система баллов риска

| Уровень | Баллы | Описание |
|---------|-------|----------|
| Безопасное | 8-10 | Признаков угроз не обнаружено |
| Низкий риск | 6-8 | Есть незначительные предупреждения |
| Средний риск | 4-6 | Обнаружены подозрительные признаки |
| Высокий риск | 2-4 | Много подозрительных признаков |
| Критический | 0-1 | Фишинг/спам/скам - перемещается в папку "Спам" |

### Выполняемые проверки

#### DNS проверки
| Проверка | Описание |
|----------|----------|
| SPF | Проверка политики SPF домена отправителя |
| DKIM | Поиск DKIM записи (проверяет типовые селекторы) |
| DMARC | Проверка политики DMARC |
| MX | Проверка наличия MX записей |

#### Анализ контента
| Проверка | Описание |
|----------|----------|
| Триггерные слова | Поиск слов категорий: срочность, угрозы, действия, деньги, учётные данные |
| Ссылки | URL shorteners, подозрительные TLD, IP вместо домена, Unicode в домене |
| Вложения | Опасные расширения (.exe, .js и др.), двойные расширения |
| HTML контент | Опасные теги (script, iframe, form), скрытые элементы, поля ввода пароля |
| Подмена бренда | Упоминание известных брендов с неофициальных доменов |

#### Проверка заголовков
| Проверка | Описание |
|----------|----------|
| Return-Path | Несоответствие домена Return-Path и From |
| X-Mailer | Подозрительные почтовые клиенты (массовые рассылки) |
| Received | Отсутствие заголовков Received |

## Структура проекта

```
mpa/
├── main.py                 # Точка входа
├── config.py               # Конфигурация и менеджер аккаунтов
├── imap_client.py          # IMAP клиент для подключения к почте
├── requirements.txt        # Зависимости
├── accounts.json           # Сохранённые аккаунты (создаётся автоматически)
├── analyzer/               # Модуль анализа писем
│   ├── __init__.py
│   ├── email_analyzer.py   # Главный анализатор
│   ├── analysis_result.py  # Классы результатов и логгер
│   ├── content_analyzer.py # Анализ контента (текст, ссылки, вложения)
│   ├── dns_checker.py      # DNS проверки (SPF, DKIM, DMARC)
│   └── data_loader.py      # Загрузчик данных из JSON
├── gui/                    # Интерфейс
│   ├── __init__.py
│   ├── main_window.py      # Главное окно
│   ├── add_account_dialog.py # Диалог добавления аккаунта
│   ├── log_viewer.py       # Просмотрщик логов
│   ├── widgets.py          # Кастомные виджеты
│   └── styles.py           # Стили
├── data/                   # Данные для анализа
│   ├── known_brands.json   # Известные бренды и их домены
│   ├── suspicious_tlds.json # Подозрительные TLD
│   ├── trigger_words.json  # Триггерные слова по категориям
│   ├── dangerous_extensions.json # Опасные расширения файлов
│   ├── imap_hosts.json     # IMAP хосты для популярных сервисов
│   └── error_messages.json # Сообщения об ошибках
└── logs/                   # Логи анализа (по аккаунтам)
    └── {email}/            # Папка для каждого аккаунта
        └── *.json          # JSON файлы с результатами
```

## Интерфейс

### Главное окно
- **Левая панель**: список почтовых аккаунтов с возможностью включения/выключения фильтрации
- **Правая панель**: журнал проверенных писем
- **Кнопки**: проверить письма, обновить логи, очистить журнал

### Карточка аккаунта
- Email и IMAP сервер
- Переключатель активности фильтрации
- Кнопка удаления аккаунта

### Журнал писем
- Каждое письмо показывает: статус, отправителя, тему, балл риска
- Детали раскрываются по клику: все найденные проблемы с описанием

### Статусы писем
- **Безопасное** (8-10) - зелёный
- **Низкий риск** (6-8) - голубой
- **Средний риск** (4-6) - жёлтый
- **Высокий риск** (2-4) - оранжевый
- **Критический** (0-1) - красный (фишинг/спам/скам)

## Безопасность

- Пароли хранятся локально в accounts.json (кодируются в Base64)
- Рекомендуется использовать пароли приложений
- Данные не передаются третьим лицам
- Все проверки выполняются локально (кроме DNS запросов)

## Конфигурация

### accounts.json
```json
{
  "accounts": [
    {
      "email": "user@gmail.com",
      "password": "base64_encoded_password",
      "host": "imap.gmail.com",
      "port": 993,
      "security": "SSL/TLS",
      "enabled": true
    }
  ]
}
```

### Типы защиты соединения
- **SSL/TLS** - порт 993 (рекомендуется)
- **STARTTLS** - порт 143
- **Нет** - порт 25 (не рекомендуется)

## Логирование

Результаты анализа сохраняются в папке `logs/` в формате JSON:
- Отдельная папка для каждого аккаунта
- Имя файла: `{дата}_{message_id}.json`
- Содержит полную информацию о проверках и их результатах
